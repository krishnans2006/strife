{% block script %}
<script>
  function processMessageKeydown(input) {
      if (event.key === 'Enter') {
          event.preventDefault();
          sendSocketMessage();
      }
  }

  // Unused in favor of websockets
  function sendMessage() {
      let contentInput = document.querySelector('#send-message #content');

      if (contentInput.value) {
          contentInput.disabled = true;

          let data = {
              content: contentInput.value,
          };

          fetch('{% url "servers:channels:messages:create" server.id channel.id %}', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': '{{ csrf_token }}',
              },
              body: JSON.stringify(data),
          })
          .then(response => response.json())
          .then(data => {
              console.log(data.result);
              contentInput.disabled = false;
              contentInput.value = '';
              contentInput.focus();
          })
          .catch(error => {
              console.error('Error:', error);
              contentInput.disabled = false;
          });
      }
  }
</script>
{% endblock script %}

<div id="send-message" class="flex flex-row w-full p-4 pt-0">
  <div class="size-10 flex-none aspect-square object-cover rounded-3xl mt-1">
    +
  </div>
  <label class="w-full">
    <input type="text" id="content" class="w-full px-4 py-2 bg-gray-800 rounded-xl text-white border-transparent focus:border-transparent focus:ring-0" placeholder="Message {{ channel.name }}" autocomplete="off" onkeydown="processMessageKeydown(this);">
  </label>
</div>
